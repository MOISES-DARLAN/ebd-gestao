{% extends 'base.html' %}
{% block title %}Chamada - {{ turma.nome }}{% endblock %}
{% block content %}
<header class="header">
    <a href="{% url 'ebd:dashboard' %}" class="header-brand" style="text-decoration: none;">El Shaday EBD</a>
    <form action="{% url 'ebd:logout' %}" method="post" style="margin:0;"><button type="submit" class="btn btn-danger">Sair</button>{% csrf_token %}</form>
</header>
<main class="container">
    <div class="card">
        <div class="page-header">
            <h1>Chamada do Dia <span style="font-weight: 300; color: #777;">({{ "now"|date:"d/m/Y" }})</span></h1>
            <a href="{% url 'ebd:turma_dashboard' turma.id %}" class="btn btn-secondary">Voltar ao Painel</a>
        </div>
        {% if messages %}{% for message in messages %}<div class="message message-success">{{ message }}</div>{% endfor %}{% endif %}
        <form method="post">
            {% csrf_token %}
            <div style="display: flex; gap: 1rem; margin-bottom: 1.5rem;">
                <div class="form-group" style="flex: 1;"><label for="oferta">Oferta do Dia (R$)</label><input type="number" step="0.01" name="oferta_do_dia" id="oferta" value="{{ chamada_de_hoje.oferta_do_dia|default:0 }}"></div>
                <div class="form-group" style="flex: 1;"><label for="visitantes">Nº de Visitantes</label><input type="number" name="visitantes" id="visitantes" value="{{ chamada_de_hoje.visitantes|default:0 }}"></div>
            </div>
            <table class="custom-table">
                <thead><tr><th>Aluno</th><th>Presente</th><th>Bíblia</th><th>Lição</th></tr></thead>
                <tbody>
                    {% for aluno in alunos %}
                    <tr>
                        <td>{{ aluno.nome_completo }}</td>
                        <td><input type="checkbox" name="presentes" value="{{ aluno.id }}" {% if aluno.id in ids_presentes_hoje %}checked{% endif %}></td>
                        <td><input type="checkbox" name="com_biblia" value="{{ aluno.id }}" {% if aluno.id in ids_com_biblia_hoje %}checked{% endif %}></td>
                        <td><input type="checkbox" name="com_licao" value="{{ aluno.id }}" {% if aluno.id in ids_com_licao_hoje %}checked{% endif %}></td>
                    </tr>
                    {% empty %}
                    <tr><td colspan="4">Nenhum aluno cadastrado. Adicione alunos na tela de "Gerenciar Alunos".</td></tr>
                    {% endfor %}
                </tbody>
            </table>
            <button type="submit" class="btn btn-primary" style="width: 100%; margin-top: 1.5rem;">Salvar Chamada</button>
        </form>
    </div>
</main>
{% endblock %}